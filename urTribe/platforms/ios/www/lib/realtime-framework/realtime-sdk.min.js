/*!
 * Realtime Cloud Storage JavaScript Library
 *
 * Copyright 2013, IBT, SA
 *
 * The Realtime Framework Storage Service is a
 * highly-scalable nosql database based on AWS's
 * DynamoDB. We've added realtime notifications
 * to keep your data synchronized between users.
 * Building collaborative applications has never been easier.
 *
 * http://framework.realtime.co/storage
 *
 * Date: Wed Mar 05 2014 v1.0.13
 */
 (function(c){(function(c,g){(function(){function i(a){return a<10?"0"+a:a}function f(a){d.lastIndex=0;return d.test(a)?'"'+a.replace(d,function(a){var b=k[a];return typeof b==="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function a(b,d){var c,g,i,k,j=m,r,o=d[b];o&&typeof o==="object"&&typeof o.toJSON==="function"&&(o=o.toJSON(b));typeof l==="function"&&(o=l.call(d,b,o));switch(typeof o){case "string":return f(o);case "number":return isFinite(o)?String(o):"null";
case "boolean":case "null":return String(o);case "object":if(!o)return"null";m+=h;r=[];if(Object.prototype.toString.apply(o)==="[object Array]"){k=o.length;for(c=0;c<k;c+=1)r[c]=a(c,o)||"null";i=r.length===0?"[]":m?"[\n"+m+r.join(",\n"+m)+"\n"+j+"]":"["+r.join(",")+"]";m=j;return i}if(l&&typeof l==="object"){k=l.length;for(c=0;c<k;c+=1)g=l[c],typeof g==="string"&&(i=a(g,o))&&r.push(f(g)+(m?": ":":")+i)}else for(g in o)Object.hasOwnProperty.call(o,g)&&(i=a(g,o))&&r.push(f(g)+(m?": ":":")+i);i=r.length===
0?"{}":m?"{\n"+m+r.join(",\n"+m)+"\n"+j+"}":"{"+r.join(",")+"}";m=j;return i}}if(typeof Date.prototype.toJSON!=="function")Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+i(this.getUTCMonth()+1)+"-"+i(this.getUTCDate())+"T"+i(this.getUTCHours())+":"+i(this.getUTCMinutes())+":"+i(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
d=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,m,h,k={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},l;if(typeof c.stringify!=="function")c.stringify=function(b,d,f){var c;h=m="";if(typeof f==="number")for(c=0;c<f;c+=1)h+=" ";else typeof f==="string"&&(h=f);if((l=d)&&typeof d!=="function"&&(typeof d!=="object"||typeof d.length!=="number"))throw Error("JSON.stringify");return a("",{"":b})};
if(typeof c.parse!=="function")c.parse=function(a,l){function d(a,b){var f,r,o=a[b];if(o&&typeof o==="object")for(f in o)Object.hasOwnProperty.call(o,f)&&(r=d(o,f),r!==g?o[f]=r:delete o[f]);return l.call(a,b,o)}var f,a=String(a);b.lastIndex=0;b.test(a)&&(a=a.replace(b,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,
"")))return f=eval("("+a+")"),typeof l==="function"?d({"":f},""):f;throw new SyntaxError("JSON.parse");}})()})(c.JSON=c.JSON||{})})(window.Realtime=window.Realtime||{});
(function(c){(function(c){c.series=function(c,f){f||(f=function(){});if(c.length===0)return f();var a=0,b=[],d=function(){c[a](function(m){b[a]=m;++a==c.length?f&&f.apply(b,b):d()})};d()};c.parallel=function(c,f){f||(f=function(){});if(c.length===0)return f();var a=0,b=0,d=[],m=function(){c[a](function(a){return function(m){d[a]=m;++b==c.length&&f&&f.apply(d,d)}}(a));++a!=c.length&&m()};m()};var g=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};c.guidGenerator=function(){return g()+
g()+"-"+g()+"-"+g()+"-"+g()+"-"+g()+g()+g()};c.idGenerator=function(){return g()+g()};c.proxy=function(c,f){if(typeof c==="function"&&typeof f==="object")return function(){return c.apply(f,arguments)}};c.parse=function(c){if(typeof c=="function")return c;if(typeof c!="string")return null;var f="",a="return "+c+"(";if(arguments.length!=1){for(var b=1;b<arguments.length;++b)f+=arguments[b]+",";f=f.substring(0,f.length-1)}a+=f+");";return new window.Function(f,a)};c.loadScript=function(c,f){var a=document.createElement("script");
a.type="text/javascript";a.readyState?a.onreadystatechange=function(){if(a.readyState=="loaded"||a.readyState=="complete")a.onreadystatechange=null,f.apply(this,arguments)}:a.onload=function(){f.apply(this,arguments)};a.src=c;document.getElementsByTagName("head").length!=0?document.getElementsByTagName("head")[0].appendChild(a):document.body.appendChild(a)};c.keys=window.Object.keys||function(c){var f=[],a;for(a in c)window.Object.prototype.hasOwnProperty.call(c,a)&&f.push(a);return f};c.isArray=
window.Array.isArray||function(c){return Object.prototype.toString.call(c)==="[object Array]"}})(c.Util=c.Util||{})})(window.Realtime=window.Realtime||{});
(function(c){(function(j,g){var i=function(){var f={},a={};this.bind=function(a){for(var d in a)typeof a[d]==="function"&&(f[d]||(f[d]=[]),f[d].push(a[d]))};this.once=function(b){for(var d in b)typeof b[d]==="function"&&(a[d]||(a[d]=[]),a[d].push(b[d]))};this.unbind=function(b){for(var d in b){if(Object.prototype.toString.call(f[d])==="[object Array]")for(var c=0,h=f[d].length;c<h;c++)if(f[d][c]===b[d]){f[d].splice(c,1);break}if(Object.prototype.toString.call(a[d])==="[object Array]"){c=0;for(h=a[d].length;c<
h;c++)if(a[d][c]===b[d]){a[d].splice(c,1);break}}}};this.unbindAll=function(b){b||(delete f,f={},delete a,a={});b&&(f[b]=g,a[b]=g)};this.fire=function(b){var d,m;for(m in b){d={};for(var h in b[m])d[h]=b[m][h];var g=[];if(Object.prototype.toString.call(f[m])==="[object Array]")for(var l=0;l<f[m].length;l++)g.push(function(a,b){return function(l){b.call(a,d);l()}}(this,f[m][l]));if(Object.prototype.toString.call(a[m])==="[object Array]"){do if(l=a[m].shift())l=function(a,b){return function(l){b.call(a,
d);l()}}(this,l),g.push(l);while(a[m].length>0)}c.Util.parallel(g)}};this.listeners=function(b){var d=[];Object.prototype.toString.call(f[b])==="[object Array]"&&(d=d.concat(f[b]));Object.prototype.toString.call(a[b])==="[object Array]"&&(d=d.concat(a[b]));return d}};j.extend=function(c){var a=new i,b;for(b in a)c[b]=a[b]}})(c.Event=c.Event||{})})(window.Realtime=window.Realtime||{});
(function(c){(function(j,g){var i=new function(){var b=this;c.Event.extend(this);for(var d=function(){var b=this,l=!1;this.work=function(d){if(!l){var c=d.get();if(c){l=!0;var f={method:c.item.method,url:c.item.url,data:c.item.parameters,headers:c.item.headers,crossDomain:c.item.crossDomain,success:function(a){typeof c.item.success=="function"&&c.item.success(a)},error:function(a){typeof c.item.error=="function"&&c.item.error(a)},complete:function(a){typeof c.item.complete=="function"&&c.item.complete(a);
l=!1;b.work(d)}};c.item.path&&(f.url+=c.item.path);a(f)}}}},f=[],l=0;l<6;l++){var q=new d;this.bind({item:function(){q.work(b)}})}this.set=function(a){f.push({item:a});this.fire({item:this})};this.get=function(){return f.length>0?f.shift():g}},f=function(a){if(typeof window.ArrayBuffer!="undefined"&&window.XMLHttpRequest)return b();if(a){if(window.XDomainRequest)return d()}else if(window.XMLHttpRequest)return b()},a=function(a){var b=f(a.crossDomain);b&&(b.create({method:a.method,url:a.url,callback:function(b,
l){var d={error:null,data:null};if(typeof l!="undefined"&&l!=null){if(a.error)d.error=l,a.error(d)}else if(a.success){try{d=c.JSON.parse(b)}catch(f){d=b}a.success(d)}a.complete&&a.complete(d)},headers:a.headers}),a.data?b.send(a.data):b.send())},b=function(){return{create:function(a){var b=this;this.xhr=new window.XMLHttpRequest;this.callback=a.callback;this.xhr.onreadystatechange=function(){b.xhr.readyState==4&&(b.xhr.status==200?b.callback(b.xhr.responseText,null,b.xhr.status):b.xhr.status==0?b.callback(null,
"The status code is 0 which likely means that the server is unavailable.",b.xhr.status):b.callback(b.xhr.responseText))};Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0&&(a.url+="?ts="+ +new Date);this.xhr.open(a.method,a.url,!0);if(a.headers)for(var d in a.headers)this.xhr.setRequestHeader(d,a.headers[d]);else a.method!="GET"&&(this.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8"),this.xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"));
return this},send:function(a){a&&typeof a!="string"?(a=c.JSON.stringify(a),this.xhr.send(a)):this.xhr.send()}}},d=function(){return{create:function(a){var b=this;this.xdr=new window.XDomainRequest;this.callback=a.callback;this.xdr.onload=function(){b.callback(b.xdr.responseText)};this.xdr.onerror=this.xdr.ontimeout=function(){b.callback(null,b.xdr.responseText&&b.xdr.responseText!=""?b.xdr.responseText:"Cannot complete the request.",500)};Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>
0&&(a.url+="?ts="+ +new Date);this.xdr.open(a.method,a.url,!0);if(a.method!="GET")try{this.xdr.contentType="text/plain"}catch(d){}return this},send:function(a){var b=this;a&&typeof a!="string"?(a=c.JSON.stringify(a),setTimeout(function(){b.xdr.send(a)},200)):setTimeout(function(){b.xdr.send()},200)}}};j.post=function(a){a.method="POST";i.set(a)};j.get=function(a){a.method="GET";if(typeof a.data!="undefined"){var b=a.url,d=a.data;b+=b.indexOf("?")==-1?"?":"&";for(var l in a.data){var c=d[l];typeof c!=
"object"&&typeof c!="boolean"&&(b+=l+"="+c+"&")}b.lastIndexOf("&")==b.length-1&&(b=b.slice(0,-1));a.url=b}i.set(a)}})(window.Realtime.Request=window.Realtime.Request||{})})(window.Realtime=window.Realtime||{});(function(c){(function(j){c.Event.extend(j);j.isReady=!1;j.ready=function(c){!j.isReady?j.bind({ready:c}):c()}})(window.Realtime.Messaging=window.Realtime.Messaging||{})})(window.Realtime=window.Realtime||{});
(function(c){(function(){(function(j,g){c.Event.extend(j);j.Connections=[];var i={},f={add:function(a){var b=a.connection.id;this.bConnections[b]||(this.bConnections[b]=[],a.connection.bind({connect:this.send}));this.bConnections[b].push(a.message)},bConnections:{},send:function(){for(var a=f.bConnections[this.id],b=0;b<a.length;++b)this.send(a[b]);this.unbind({connect:f.send});f.bConnections[this.id]=g}};j.create=function(a){return this.add(new c.Messaging.Connection(a))};j.add=function(a){if(this.getById(a.id))return null;
this.Connections.push(a.id);i[a.internalId]=a;this.fire({create:{connection:a}});a.bind({message:function(a){j.fire({message:{connection:this,channel:a.channel,message:a.message}})}});a.bind({dispose:function(){var a=this.internalId;i[a]=null;delete i[a];for(var a=0,d=j.Connections,c=d.length;a<c;a++)if(d[a]===this.id){d.splice(a,1);break}j.fire({dispose:{connection:this}})}});return a};j.getById=function(a){var b;if(!(b=i[a]))a:{for(var d in i)if(i[d].id===a){b=i[d];break a}b=g}return b};j.dispose=
function(a){(a=this.getById(a))&&a.dispose();return!!a};j.addChannel=function(a){var b=this.getById(a.connectionId);b&&b.createChannel(a);return!!b};j.sendMessage=function(a){for(var b,d=0;d<a.connections.length;++d)(b=this.getById(a.connections[d]))&&(b.isConnected()?b.send(a):f.add({connection:b,message:{channel:a.channel,content:a.content,sendOnly:a.sendOnly}}))}})(c.Messaging.ConnectionManager=c.Messaging.ConnectionManager||{})})(c.Messaging=c.Messaging||{})})(window.Realtime=window.Realtime||
{});
(function(c){(function(j){j.Connection=function(g){function i(b,d){this.isCreated()&&this.isConnected()?this.send(b):++d<=this.sendRetries&&setTimeout(a(function(){i.call(this,b,d)},this),this.sendInterval)}var f=null;c.Event.extend(this);this.internalId=c.Util.guidGenerator();this.id=g.id||this.internalId;this.appKey=g.appKey;this.authToken=g.authToken;this.sendRetries=parseInt(g.sendRetries,10)||5;this.sendInterval=parseInt(g.sendInterval,10)||1E3;this.timeout=parseInt(g.timeout,10)||1E4;this.connectAttempts=parseInt(g.connectAttempts,
10)||5;this.connectionAttemptsCounter=0;this.autoConnect=typeof g.autoConnect=="boolean"?g.autoConnect:!0;this.metadata=g.metadata;this.url=g.url;this.isCluster=typeof g.isCluster=="boolean"?g.isCluster:!0;this.announcementSubChannel=g.announcementSubChannel;this.channels={};var a=c.Util.proxy,b=c.Util.parse;this.messageAdapter=b(g.messageAdapter,"message");this.bind({create:b(g.onCreate,"e"),connect:b(g.onConnect,"e"),channelCreate:b(g.onChannelCreate,"e"),disconnect:b(g.onDisconnect,"e"),subscribe:b(g.onSubscribe,
"e"),unsubscribe:b(g.onUnsubscribe,"e"),exception:b(g.onException,"e"),reconnect:b(g.onReconnect,"e"),reconnecting:b(g.onReconnecting,"e"),message:b(g.onMessage,"e"),dispose:b(g.onDispose,"e")});var d=g.heartbeat,m=a(function(a,b,d){this.process({channel:b,message:d})},this),h=function(b){f=b.createClient();f.setId(this.internalId);f.setConnectionTimeout(this.timeout);f.setConnectionMetadata(typeof this.metadata=="object"?c.JSON.stringify(this.metadata):this.metadata);f.setAnnouncementSubChannel(this.announcementSubChannel);
!this.isCluster?f.setUrl(this.url):f.setClusterUrl(this.url);f.onConnected=a(function(a){for(var b in this.channels){var d=this.channels[b];d.subscribe&&a.subscribe(d.name,d.subscribeOnReconnect,m)}this.fire({connect:{}})},this);f.onDisconnected=a(function(){this.fire({disconnect:{}})},this);f.onSubscribed=a(function(a,b){this.channels[b].fire({subscribe:{}});this.fire({subscribe:{channel:b}})},this);f.onUnsubscribed=a(function(a,b){var d=this.channels[b];delete this.channels[b];d.fire({unsubscribe:{}});
this.fire({unsubscribe:{channel:b}})},this);f.onException=a(function(a,b){this.fire({exception:{message:b}})},this);f.onReconnected=a(function(){this.connectionAttemptsCounter=0;this.fire({reconnect:{}})},this);f.onReconnecting=a(function(a){this.connectionAttemptsCounter>=this.connectAttempts?a.disconnect():(this.connectionAttemptsCounter++,this.fire({reconnecting:{}}))},this);d&&this.setHeartbeat(d);this.fire({create:{}});this.autoConnect&&f.connect(this.appKey,this.authToken)};this.dispose=function(){this.isConnected()&&
this.disconnect();this.fire({dispose:{}})};this.createChannel=function(a){if(!a)return this.fire({exception:{message:"No channel to create."}}),null;if(this.channels[a.name])return this.channels[a.name];var d={name:a.name,subscribeOnReconnect:typeof a.subscribeOnReconnect=="boolean"?a.subscribeOnReconnect:!0,subscribe:typeof a.subscribe=="boolean"?a.subscribe:!0,messageAdapter:b(a.messageAdapter,"message")};c.Event.extend(d);d.bind({message:b(a.onMessage,"e"),subscribe:b(a.onSubscribe,"e"),unsubscribe:b(a.onUnsubscribe,
"e")});this.channels[a.name]=d;this.fire({channelCreate:{channel:d}});return d};this.process=function(a){var b=a.channel,d=a.message;c.Util.series([c.Util.proxy(function(a){this.messageAdapter&&(d=this.messageAdapter(d));a()},this),c.Util.proxy(function(a){this.fire({message:{channel:b,message:d}});a()},this)]);this.channels[b]&&c.Util.series([c.Util.proxy(function(a){this.channels[b].messageAdapter&&(d=this.channels[b].messageAdapter(d));a()},this),c.Util.proxy(function(a){this.channels[b].fire({message:{message:d}});
a()},this)])};this.send=function(b){if(this.isCreated()&&this.isConnected()){var d=b.content;f.send(b.channel,typeof d==="object"?c.JSON.stringify(d):d)}else setTimeout(a(function(){i.call(this,b,0)},this),this.sendInterval)};this.connect=function(a){if(this.isCreated()){if(a)this.appKey=a.appKey,this.authToken=a.authToken;f.connect(this.appKey,this.authToken)}else this.autoConnect=!0};this.disconnect=function(){this.isConnected()?f.disconnect():this.fire({exception:{message:"Already disconnected."}})};
this.subscribe=function(a){var b=this.channels[a.name];b||(b=this.createChannel(a));f.subscribe(b.name,b.subscribeOnReconnect,m)};this.unsubscribe=function(a){f.unsubscribe(a)};this.isCreated=function(){return f!=null};this.isConnected=function(){return this.isCreated()?f.getIsConnected():!1};this.isSubscribed=function(a){return this.isConnected()?f.isSubscribed(a):!1};this.getMetadata=function(){if(this.isCreated()){var a=f.getConnectionMetadata();try{return c.JSON.parse(a)}catch(b){return a}}return null};
this.setMetadata=function(a){if(this.isCreated())f.setConnectionMetadata(typeof a=="object"?c.JSON.stringify(a):a),this.metadata=a};this.getAnnouncementSubChannel=function(){return this.isCreated()?f.getAnnouncementSubChannel():null};this.getProtocol=function(){return this.isConnected()?f.getProtocol():null};this.setProtocol=function(a){this.isCreated()&&f.setProtocol(a)};this.presence=function(a,b){var d={channel:a};if(!this.isCreated()||!this.isConnected())d.applicationKey=this.appKey,d.authenticationToken=
this.authToken,d.isCluster=this.isCluster,d.url=this.url;f.presence(d,b)};this.setHeartbeat=function(a){typeof a.active!="undefined"&&f.setHeartbeatActive(a.active);typeof a.fails!="undefined"&&f.setHeartbeatFails(a.fails);typeof a.time!="undefined"&&f.setHeartbeatTime(a.time)};this.getHeartbeat=function(){return{isActive:f.getHeartbeatActive(),fails:f.getHeartbeatFails(),time:f.getHeartbeatTime()}};window.loadOrtcFactory?loadOrtcFactory("IbtRealTimeSJ",a(h,this)):c.Messaging.ready(a(function(){a(loadOrtcFactory,
this)("IbtRealTimeSJ",a(h,this))},this));if(g.channels&&Object.prototype.toString.call(g.channels)==="[object Array]")for(var g=g.channels,k=0;k<g.length;++k)this.createChannel(g[k])}})(c.Messaging=c.Messaging||{})})(window.Realtime=window.Realtime||{});
(function(c){(function(){(function(j){j.active=!1;var g=function(){return typeof console!=="undefined"?console:{log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){}}}();c.Messaging.ConnectionManager.bind({create:function(i){i.connection.bind({create:function(){j.active&&g.log("Connection "+this.id+" created. "+(this.autoConnect?"Connecting...":"Waiting for explicit connect..."))},connect:function(){if(j.active){var c="Connection "+this.id+" established. Using "+
this.getProtocol()+" protocol.";g.log(c)}},disconnect:function(){j.active&&g.log("Connection "+this.id+" closed.")},subscribe:function(c){j.active&&g.log("Connection "+this.id+": Channel "+c.channel+" subscribed.")},unsubscribe:function(c){j.active&&g.log("Connection "+this.id+": Channel "+c.channel+" unsubscribed.")},exception:function(c){j.active&&g.log("Connection "+this.id+" threw an exception: "+c.message)},reconnect:function(){if(j.active){var c="Connection "+this.id+" is restored. Using "+
this.getProtocol()+" protocol.";g.log(c)}},reconnecting:function(){if(j.active){var c="Connection "+this.id+" was lost. ";c+=this.connectionAttemptsCounter>=this.connectAttempts?"Maximum number of attempts reached: "+this.connectAttempts+" Stop trying to reconnect.":"Trying to reconnect. Attempt "+this.connectionAttemptsCounter+" out of "+this.connectAttempts;g.log(c)}},message:function(f){if(j.active){var a="Connection "+this.id+": Message received from channel "+f.channel,b;try{b=c.JSON.parse(f.message)}catch(d){b=
f.message}g.log(a);g.log(b)}}})}})})(c.Messaging.TraceMonitor=c.Messaging.TraceMonitor||{})})(c.Messaging=c.Messaging||{})})(window.Realtime=window.Realtime||{});
(function(c){(function(j){j.debug=!1;j.create=function(g,i,f){if(!g.applicationKey)return f&&f("Cannot create a storage reference without specifying a valid application key."),null;if(!g.authenticationToken)return f&&f("Cannot create a storage reference without specifying an authenticated token."),null;var a;a=null;navigator.appName=="Microsoft Internet Explorer"&&/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)!=null&&(a=parseFloat(RegExp.$1));if(a&&a<10){a=window.location.protocol;var b="Cannot create a StorageRef with the specified arguments. ";
b+="In order to do cross-domain requests, the requesting page must be using the same protocol (http or https) as the server. ";b+="You are trying to do requests from "+a+" protocol to "+(g.isSecure?"https: protocol.":"http: protocol.");if(a=="file:")return f&&f(b),null;if(g.url){if(!g.url.match(a))return f&&f("The specified url does not match the page protocol. "+b),null}else if(a!=(g.isSecure?"https:":"http:"))return f&&f(b),null}return new c.Storage.StorageRef(g,i,f)};j.ProvisionType={Light:1,Medium:2,
Intermediate:3,Heavy:4,Custom:5};j.ProvisionLoad={Read:1,Write:2,Balanced:3,Custom:4}})(window.Realtime.Storage=window.Realtime.Storage||{})})(window.Realtime=window.Realtime||{});
(function(c){(function(j,g){function i(a,b,d,c){if(a.error){if(c)if(!b&&typeof a.error=="string"&&a.error.match("unavailable")&&a.error.match("status")&&a.error.match("0")&&a.error.match("server"))c({error:a.error,retry:!0});else{if(a.error.code>=500&&a.error.code<600&&!a.error.message)a.error.message="Server Error: "+a.error.code;c({error:a.error,retry:!1})}}else d&&d(a.data)}var f={"Content-Type":"application/json; charset=utf-8"};j.Operation=function(a){c.Event.extend(this);this.applicationKey=
a.applicationKey;this.authenticationToken=a.authenticationToken;this.isSecure=typeof a.isSecure=="boolean"?a.isSecure:!1;this.isCluster=typeof a.isCluster=="boolean"?a.isCluster:!0;var b=!this.isCluster?a.url:g;this.url=this.isCluster?function(){function d(a,d){if(b)return a&&a(b),b;else g||(g=!0,c.Request.get({url:f,crossDomain:!0,complete:function(a){if(a.url){b=a.url;for(a=0;a<i.length;++a)i[a].success(b)}else for(var d="Could not retrieve the server url from the cluster. "+(typeof a.error=="object"?
a.error.message:a.error),a=0;a<i.length;++a)i[a].error(d);i=[];g=!1}})),i.push({success:a||function(){},error:d||function(){}})}var f=a.url||(a.isSecure?"https://storage-balancer.realtime.co/server/ssl/1.0":"http://storage-balancer.realtime.co/server/1.0"),g=!1,i=[];d();return d}():function(a){a&&a(b);return b};this.refreshUrl=function(a){this.isCluster&&(b=g);this.url(a)};setInterval(function(){this.refreshUrl(function(){})}.bind(this),3E5)};j.Operation.prototype={isAuthenticated:function(a,b,d,
g){var h=this;a.applicationKey=this.applicationKey;a.authenticationToken=this.authenticationToken;this.url(function(k){c.Request.post({url:k,path:"/isAuthenticated",parameters:a,crossDomain:!0,headers:f,complete:function(c){i(c,g,b,function(c){c.retry?h.refreshUrl(function(){h.isAuthenticated(a,b,d,!0)},d):d&&d(c.error.message)})}})},d)},incr:function(a,b,d,g){var h=this;a.applicationKey=this.applicationKey;a.authenticationToken=this.authenticationToken;this.url(function(k){c.Request.post({url:k,
path:"/incr",parameters:a,crossDomain:!0,headers:f,complete:function(c){i(c,g,b,function(c){c.retry?h.refreshUrl(function(){h.incr(a,b,d,!0)},d):d&&d(c.error.message)})}})},d)},decr:function(a,b,d,g){var h=this;a.applicationKey=this.applicationKey;a.authenticationToken=this.authenticationToken;this.url(function(k){c.Request.post({url:k,path:"/decr",parameters:a,crossDomain:!0,headers:f,complete:function(c){i(c,g,b,function(c){c.retry?h.refreshUrl(function(){h.decr(a,b,d,!0)},d):d&&d(c.error.message)})}})},
d)},listItems:function(a,b,d,g){var h=this;a.applicationKey=this.applicationKey;a.authenticationToken=this.authenticationToken;this.url(function(k){c.Request.post({url:k,path:"/listItems",parameters:a,crossDomain:!0,headers:f,complete:function(c){i(c,g,b,function(c){c.retry?h.refreshUrl(function(){h.listItems(a,b,d,!0)},d):d&&d(c.error.message)})}})},d)},queryItems:function(a,b,d,g){var h=this;a.applicationKey=this.applicationKey;a.authenticationToken=this.authenticationToken;this.url(function(k){c.Request.post({url:k,
path:"/queryItems",parameters:a,crossDomain:!0,headers:f,complete:function(c){i(c,g,b,function(c){c.retry?h.refreshUrl(function(){h.queryItems(a,b,d,!0)},d):d&&d(c.error.message)})}})},d)},getItem:function(a,b,d,g){var h=this;a.applicationKey=this.applicationKey;a.authenticationToken=this.authenticationToken;this.url(function(k){c.Request.post({url:k,path:"/getItem",parameters:a,crossDomain:!0,headers:f,complete:function(c){i(c,g,b,function(c){c.retry?h.refreshUrl(function(){h.getItem(a,b,d,!0)},
d):d&&d(c.error.message)})}})},d)},putItem:function(a,b,d,g){var h=this;a.applicationKey=this.applicationKey;a.authenticationToken=this.authenticationToken;this.url(function(k){c.Request.post({url:k,path:"/putItem",parameters:a,crossDomain:!0,headers:f,complete:function(c){i(c,g,b,function(c){c.retry?h.refreshUrl(function(){h.putItem(a,b,d,!0)},d):d&&d(c.error.message)})}})},d)},updateItem:function(a,b,d,g){var h=this;a.applicationKey=this.applicationKey;a.authenticationToken=this.authenticationToken;
this.url(function(k){c.Request.post({url:k,path:"/updateItem",parameters:a,crossDomain:!0,headers:f,complete:function(c){i(c,g,b,function(c){c.retry?h.refreshUrl(function(){h.updateItem(a,b,d,!0)},d):d&&d(c.error.message)})}})},d)},deleteItem:function(a,b,d,g){var h=this;a.applicationKey=this.applicationKey;a.authenticationToken=this.authenticationToken;this.url(function(k){c.Request.post({url:k,path:"/deleteItem",parameters:a,crossDomain:!0,headers:f,complete:function(c){i(c,g,b,function(c){c.retry?
h.refreshUrl(function(){h.deleteItem(a,b,d,!0)},d):d&&d(c.error.message)})}})},d)},createTable:function(a,b,d,g){var h=this;a.applicationKey=this.applicationKey;a.authenticationToken=this.authenticationToken;this.url(function(k){c.Request.post({url:k,path:"/createTable",parameters:a,crossDomain:!0,headers:f,complete:function(c){i(c,g,b,function(c){c.retry?h.refreshUrl(function(){h.createTable(a,b,d,!0)},d):d&&d(c.error.message)})}})},d)},updateTable:function(a,b,d,g){var h=this;a.applicationKey=this.applicationKey;
a.authenticationToken=this.authenticationToken;this.url(function(k){c.Request.post({url:k,path:"/updateTable",parameters:a,crossDomain:!0,headers:f,complete:function(c){i(c,g,b,function(c){c.retry?h.refreshUrl(function(){h.updateTable(a,b,d,!0)},d):d&&d(c.error.message)})}})},d)},deleteTable:function(a,b,d,g){var h=this;a.applicationKey=this.applicationKey;a.authenticationToken=this.authenticationToken;this.url(function(k){c.Request.post({url:k,path:"/deleteTable",parameters:a,crossDomain:!0,headers:f,
complete:function(c){i(c,g,b,function(c){c.retry?h.refreshUrl(function(){h.deleteTable(a,b,d,!0)},d):d&&d(c.error.message)})}})},d)},listTables:function(a,b,d,g){var h=this;a.applicationKey=this.applicationKey;a.authenticationToken=this.authenticationToken;this.url(function(k){c.Request.post({url:k,path:"/listTables",parameters:a,crossDomain:!0,headers:f,complete:function(c){i(c,g,b,function(c){c.retry?h.refreshUrl(function(){h.listTables(a,b,d,!0)},d):d&&d(c.error.message)})}})},d)},describeTable:function(a,
b,d,g){var h=this;a.applicationKey=this.applicationKey;a.authenticationToken=this.authenticationToken;this.url(function(k){c.Request.post({url:k,path:"/describeTable",parameters:a,crossDomain:!0,headers:f,complete:function(c){i(c,g,b,function(c){c.retry?h.refreshUrl(function(){h.describeTable(a,b,d,!0)},d):d&&d(c.error.message)})}})},d)}}})(window.Realtime.Storage=window.Realtime.Storage||{})})(window.Realtime=window.Realtime||{});
(function(c){(function(j,g){j.StorageRef=function(i,f,a){var a=a?a:function(a){j.debug&&console&&console.error&&console.error(a)},b=this,d=new c.Storage.Operation(i),m=this.connection=c.Messaging.ConnectionManager.create({url:i.isSecure?"https://ortc-storage.realtime.co/server/ssl/2.1/":"http://ortc-storage.realtime.co/server/2.1/",appKey:i.applicationKey,authToken:i.authenticationToken,connectAttempts:100,autoConnect:!1,metadata:i.metadata,heartbeat:i.heartbeat,onConnect:typeof i.onConnect=="function"?
function(){i.onConnect.call(b,b);f&&f(b)}:function(){f&&f(b)},onDisconnect:typeof i.onDisconnect=="function"?function(){i.onDisconnect.call(b,b)}:g,onReconnect:typeof i.onReconnect=="function"?function(){i.onReconnect.call(b,b)}:g,onReconnecting:typeof i.onReconnecting=="function"?function(){i.onReconnecting.call(b,b)}:g,onException:typeof i.onException=="function"?function(c){i.onException.call(b,b,c);a(c)}:a});this.applicationKey=i.applicationKey;this.authenticationToken=i.authenticationToken;var h=
{tables:{},add:function(a){h.tables[a]||(h.tables[a]={pending:!0},d.describeTable({applicationKey:this.applicationKey,authenticationToken:this.authenticationToken,table:a},function(c){h.tables[c.name].pending=!1;h.tables[c.name].metadata=c;var b={};b["meta_"+a]=c;h.fire(b)},function(c){var b={};b["meta_"+a]={error:c};h.fire(b)}))},remove:function(a){h.tables[a]&&delete h.tables[a]},get:function(a,c,b){if(h.tables[a]&&!h.tables[a].pending)c(h.tables[a].metadata);else{var d={};d["meta_"+a]=function(a){a.error?
b&&b(a.error):c&&c(a)};h.once(d);(!h.tables[a]||!h.tables[a].pending)&&h.add(a)}return g}};c.Event.extend(h);var k=function(){function c(){if(typeof f!="undefined")if(f){var d=Array.prototype.slice.call(arguments),h=d.shift();h.apply(h,d)}else a("Token "+b.authenticationToken+" is not authenticated.");else g.push(Array.prototype.slice.call(arguments))}var f,g=[];d.isAuthenticated({authenticationToken:i.authenticationToken},function(d){if(f=d){m.connect();for(d=0;d<g.length;++d)c.apply(this,g[d])}else g=
[],a("Token "+b.authenticationToken+" is not authenticated.")},a);return c}();this.table=function(a,b){if(!a)return b&&b("Table name is mandatory."),null;k(h.add,a);return new c.Storage.TableRef({name:a,connection:m,operationManager:d,meta:function(c,b){k(h.get,a,c,b)}})};this.isAuthenticated=function(a,c,b){if(typeof a!="string")return b&&b("No token to verify."),this;d.isAuthenticated({authenticationToken:a},c,b);return this};this.getTables=function(a,b){d.listTables({},function(b){if(a){for(var f=
0;f<b.tables.length;f++)a(new c.Storage.TableSnapshot({name:b.tables[f],connection:m,operationManager:d,meta:function(a){return function(c,b){k(h.get,a,c,b)}}(b.tables[f])}));a(null)}},b);return this};this.heartbeat=function(){if(arguments.length==0)return console&&console.error("heartbeat takes at least one parameter."),this;if(arguments.length==1&&typeof arguments[0]=="function")arguments[0](m.getHeartbeat());else{var a,c,b,d;d=typeof arguments[arguments.length-1]=="function"?arguments[arguments.length-
1]:function(a){console&&console.error(a)};if(typeof arguments[0]!="boolean")return d("Parameter 'active' is mandatory."),this;a=arguments[0];if(typeof arguments[1]=="number")if(arguments[1]>0&&arguments[1]<7)c=arguments[1];else return d("Parameter 'fails' must be between 1 and 6."),this;if(typeof arguments[2]=="number")if(arguments[2]>9&&arguments[2]<61)b=arguments[2];else return d("Parameter 'time' must be between 10 and 60."),this;m.setHeartbeat({active:a,fails:c,time:b})}return this}}})(window.Realtime.Storage=
window.Realtime.Storage||{})})(window.Realtime=window.Realtime||{});
(function(c){(function(j,g){j.TableRef=function(i){function f(a){var c="rtcs_"+t;a&&(c+=":"+a);return c}function a(a,b,d,h){b=f(b);l.channels[b]||(l.isConnected()?l.subscribe({name:b}):l.createChannel({name:b}),l.channels[b].bind({message:function(a){return function(b){var d=c.JSON.parse(b.message),r=a+":"+d.type;u.listeners(r).length!=0&&p(function(a){var b={};b[r]=new c.Storage.ItemSnapshot({key:{primary:d[a.key.primary.name],secondary:a.key.secondary?d[a.key.secondary.name]:g},table:k,connection:l,
value:d.data});u.fire(b)})}}(b)}));var i={};i[b+":"+a]=h;u[d?"once":"bind"](i)}function b(a,c,b){c=f(c);if(a)if(a=c+":"+a,typeof b!="function")u.unbindAll(a);else{var d={};d[a]=b;u.unbind(d)}else u.unbindAll();l.channels[c]&&u.listeners(c+":put").length==0&&u.listeners(c+":update").length==0&&u.listeners(c+":delete").length==0&&l.unsubscribe(c)}function d(){var c=function(a){j.debug&&console&&console.error&&console.error(a)};if(arguments.length==1||arguments.length==2||arguments.length>5)return c("Invalid arguments. You must specify an event type and a success callback. The primary key is optional."),
this;var b=arguments[0],d=arguments[1],f,h;if(d!="put"&&d!="delete"&&d!="update")return c("Invalid event type. Possible values: put, delete and update"),this;if(typeof arguments[2]!="function"){f=arguments[2];if(typeof f!="string"&&typeof f!="number")return c("Invalid primary key. It must be a string or a number."),this;if(typeof arguments[3]!="function")return c("Must specify a success function."),this;h=arguments[3];c=typeof arguments[4]=="function"?arguments[4]:c;a(d,f,b,h);d=="put"&&this.meta(function(a){a=
a.key;a.secondary?m().equals({item:a.primary.name,value:f}).getItems(h,function(a){c(a);return k}):k.item({primary:f}).get(h,c)})}else h=arguments[2],c=typeof arguments[3]=="function"?arguments[3]:c,d=="put"&&k.getItems(h,c),n.length!=0?this.meta(function(c){for(var c=c.key,r=!1,f=0;f<n.length&&!r;f++)n[f].item==c.primary.name&&n[f].operator=="equals"&&(a(d,n[f].value,b,h),r=!0);r||a(d,g,b,h)}):a(d,g,b,h);return this}function m(a){a=a||{};return new j.TableRef({connection:l,operationManager:q,meta:p,
name:t,limit:a.limit||s,searchForward:typeof a.searchForward!="undefined"?a.searchForward:v,filters:a.filter?function(){var c=n.concat();c.push(a.filter);return c}():n.concat()})}function h(a,c,b,d){if(typeof c!="string")return d&&d("Invalid filter. The property item must be defined and be a string."),this;return typeof b=="undefined"?(d&&d("Invalid filter. The property value must be defined."),this):m({filter:{operator:a,item:c,value:b}})}var k=this;c.Event.extend(this);var l=i.connection,q=i.operationManager,
p=i.meta,s=i.limit||0,v=typeof i.searchForward!="undefined"?i.searchForward:!0,n=i.filters||[],t=i.name,u={};c.Event.extend(u);this.name=function(){return t};this.filters=function(){return n.concat()};this.limit=function(a,c){return typeof a!="number"||a<=0?(c&&c("The limit must be a number greater than zero."),this):m({limit:a})};this.asc=function(){return m({searchForward:!0})};this.desc=function(){return m({searchForward:!1})};this.notNull=function(a,c){return typeof a.item!="string"?(c&&c("Invalid filter. The property item must be defined and be a string."),
this):m({filter:{operator:"notNull",item:a.item}})};this.isNull=function(a,c){return typeof a.item!="string"?(c&&c("Invalid filter. The property item must be defined and be a string."),this):m({filter:{operator:"null",item:a.item}})};this.equals=function(a,c){return h("equals",a.item,a.value,c)};this.notEquals=function(a,c){return h("notEquals",a.item,a.value,c)};this.greaterEqual=function(a,c){return h("greaterEqual",a.item,a.value,c)};this.greaterThan=function(a,c){return h("greaterThan",a.item,
a.value,c)};this.lesserEqual=function(a,c){return h("lessEqual",a.item,a.value,c)};this.lesserThan=function(a,c){return h("lessThan",a.item,a.value,c)};this.contains=function(a,c){return h("contains",a.item,a.value,c)};this.notContains=function(a,c){return h("notContains",a.item,a.value,c)};this.beginsWith=function(a,c){return h("beginsWith",a.item,a.value,c)};this.between=function(a,b){return!c.Util.isArray(a.value)||a.value.length!=2?(b&&b("Invalid filter. The property value must be defined and must be an array (length 2) of numbers."),
this):h("between",a.item,a.value,b)};this.meta=function(a,c){p(a,c);return this};this.del=function(a,c){q.deleteTable({table:t},function(c){a&&a(c.data)},c);return this};this.push=function(a,b,d){if(typeof a!="object"||c.Util.keys(a).length==0)return d&&d("Item is not an object or has no properties."),this;p(function(f){var h=f.key;if(!(h.primary.name in a))return d&&d("Item is missing the primary key property."),k;if(typeof a[h.primary.name]!=h.primary.dataType)return d&&d("Type mismatch between table schema and primary keys' secondary key."),
k;if(h.secondary){if(!(h.secondary.name in a))return d&&d("Item is missing the secondary key property."),k;if(typeof a[h.secondary.name]!=h.secondary.dataType)return d&&d("Type mismatch between table schema and secondary keys' secondary key."),k;if(c.Util.keys(a).length<=2)return d&&d("Cannot put an item that only contains key properties."),k}else if(c.Util.keys(a).length<=1)return d&&d("Cannot put an item that only contains the key property."),k;q.putItem({table:t,item:a},function(d){b&&b(new c.Storage.ItemSnapshot({table:k,
key:{primary:a[h.primary.name],secondary:h.secondary?a[h.secondary.name]:g},connection:l,value:d,operationManager:q}))},d)},d);return this};this.create=function(a,c,b){if(!a.provisionType)return b&&b("Missing provision type property. Must specify the provision type properties. The provision values must be between 1 and 5. Use the constants in the Storage.ProvisionType object"),this;if(typeof a.provisionType!="number")return b&&b("Invalid provision. Must specify the provision type properties. The provision values must be between 1 and 5. Use the constants in the Storage.ProvisionType object"),
this;if(!a.key)return b&&b("Missig argument key. The key schema must be specified"),this;if(typeof a.key.primary!="object")return b&&b("Missing primary key. The primary key property must be an object."),this;if(typeof a.key.primary.name=="undefined"||typeof a.key.primary.dataType=="undefined")return b&&b("The primary key must contain a name and a data type (dataType) properties."),this;if(a.key.primary.dataType!="string"&&a.key.primary.dataType!="number")return b&&b('Invalid primary key dataType. Must be "number" or "string".'),
this;var d={table:t,provisionType:a.provisionType,key:{primary:a.key.primary}};if(a.key.secondary){if(typeof a.key.secondary!="object")return b&&b("The secondary key property must be an object."),this;if(typeof a.key.secondary.name=="undefined"||typeof a.key.secondary.dataType=="undefined")return b&&b("The secondary key must contain a name and a data type (dataType) properties."),this;if(a.key.secondary.dataType!="string"&&a.key.secondary.dataType!="number")return b&&b('Invalid secondary key dataType. Must be "number" or "string".'),
this;d.key.secondary=a.key.secondary}if(d.provisionType==5){if(typeof a.throughput!="object")return b&&b("Invalid throughput. For custom provision you must specify the throughput object with the read and write values. The values mean operations per second (ex: 2 reads per second and 3 writes per second)."),this;if(typeof a.throughput.read!="number")return b&&b("Invalid read throughput. Must be a number"),this;if(typeof a.throughput.write!="number")return b&&b("Invalid write throughput. Must be a number"),
this;d.throughput=a.throughput}else{if(!a.provisionLoad)return b&&b("Must specify the provision load property. The provision values must be between 1 and 3. Use the constants in the Storage.ProvisionLoads object"),this;if(typeof a.provisionLoad!="number")return b&&b("Invalid provision. Must specify the provision properties. The provision load value must be between 1 and 3. Use the constants in the Storage.ProvisionLoads object"),this;d.provisionLoad=a.provisionLoad}q.createTable(d,c,b);return this};
this.update=function(a,c,b){var d={table:t};if(!a.provisionType&&!a.provisionLoad)return b&&b("Nothing to update. Must specify a provision load or a provision type. Use the constants in the Storage.ProvisionType and Storage.ProvisionLoad objects"),this;if(a.provisionType){if(typeof a.provisionType!="number")return b&&b("Invalid provisionType property. The provision values must be between 1 and 5. Use the constants in the Storage.ProvisionType object"),this;d.provisionType=a.provisionType}if(a.provisionLoad){if(typeof a.provisionLoad!=
"number")return b&&b("Invalid provisionLoad property. The provision values must be between 1 and 3. Use the constants in the Storage.ProvisionLoad object"),this;d.provisionLoad=a.provisionLoad}if(a.provisionType==5){if(typeof a.throughput!="object")return b&&b("Invalid throughput. For custom provision you must specify the throughput object with the read and write values. The values mean operations per second (ex: 2 reads per second and 3 writes per second)."),this;if(typeof a.throughput.read!="number")return b&&
b("Invalid read throughput. Must be a number"),this;if(typeof a.throughput.write!="number")return b&&b("Invalid write throughput. Must be a number"),this;d.throughput=a.throughput}q.updateTable(d,function(a){c&&c(a)},b);return this};this.item=function(a,b){if(typeof a=="undefined"||a===null)return b&&b("Invalid key argument. Must be an object containing the primary key and, if exists, the secondary key."),null;return typeof a.primary!="string"&&typeof a.primary!="number"?(b&&b("Invalid key object. Primary key missing"),
null):new c.Storage.ItemRef({key:a,table:this,connection:l,operationManager:q})};this.getItems=function(a,b){p(function(d){var f,h=d.key,i={table:t};if(h.secondary&&n.length==1)d=n[0],d.item==h.primary.name&&d.operator=="equals"?(i.key={primary:d.value},f="queryItems"):(f="listItems",i.filter=n.concat());else if(h.secondary&&n.length==2){for(var j,m,u=0;u<n.length;u++){d=n[u];if(d.item==h.primary.name&&d.operator=="equals")j=d.value;d.item==h.secondary.name&&(m=d)}j&&m?(f="queryItems",i.key={primary:j},
i.filter=m):(f="listItems",i.filter=n.concat())}else if(f="listItems",n.length>0)i.filter=n.concat();if(s>0)i.limit=s;if(f=="queryItems")i.searchForward=v;var p=!1,x=0,y=0,w=function(d){var j=d.items;x+=j.length;s>0?s<=x?p=!0:d.stopKey?(i.startKey=d.stopKey,q[f](i,w,b)):p=!0:d.stopKey?(i.startKey=d.stopKey,q[f](i,w,b)):p=!0;if(f!="queryItems"){var t=h.secondary?"secondary":"primary";h[t].dataType=="number"?v?j.sort(function(a,c){return a[h[t].name]-c[h[t].name]}):j.sort(function(a,c){return-1*(a[h[t].name]-
c[h[t].name])}):v?j.sort(function(a,c){return a[h[t].name].localeCompare(c[h[t].name])}):j.sort(function(a,c){return-1*a[h[t].name].localeCompare(c[h[t].name])})}if(s>0)for(d=0;d<j.length&&y<s;d++)(function(b){var d={primary:b[h.primary.name]};if(h.secondary)d.secondary=b[h.secondary.name];a&&a(new c.Storage.ItemSnapshot({key:d,table:k,connection:l,value:b,operationManager:q}))})(j[d]),y++;else for(d=0;d<j.length;d++)(function(b){a&&a(new c.Storage.ItemSnapshot({key:{primary:b[h.primary.name],secondary:typeof h.secondary!=
"undefined"?b[h.secondary.name]:g},table:k,connection:l,value:b,operationManager:q}))})(j[d]);p&&a&&a(null)};q[f](i,w,b)},b);return this};this.on=function(){var a=[].slice.apply(arguments);a.unshift(!1);d.apply(this,a)};this.off=function(){var a=arguments.length!=0?arguments[0]:g,c,d,f=function(a){j.debug&&console&&console.error&&console.error(a)};switch(arguments.length){case 4:c=arguments[1];d=arguments[2];f=typeof arguments[3]=="function"?arguments[3]:f;break;case 3:typeof arguments[1]=="function"?
(d=arguments[1],f=typeof arguments[2]=="function"?arguments[2]:f):(c=arguments[1],d=arguments[2]);break;case 2:d=arguments[1]}a?a!="put"&&a!="delete"&&a!="update"?f("Invalid event type. Possible values: put, delete and update"):typeof c!="undefined"?b(a,c,d):n.length!=0?this.meta(function(c){for(var c=c.key,f=!1,h=0;h<n.length&&!f;h++)n[h].item==c.primary.name&&n[h].operator=="equals"&&(b(a,n[h].value,d),f=!0);f||b(a,g,d)}):b(a,g,d):b();return this};this.once=function(){var a=[].slice.apply(arguments);
a.unshift(!0);d.apply(this,a)};this.presence=function(){var a,c,b;typeof arguments[0]!="function"?(a=arguments[0],b=2):b=1;c=arguments[b-1];b=typeof arguments[2]=="function"?arguments[2]:b=function(a){console&&console.error(a)};if(typeof c!="function")return b("A callback method is mandatory."),this;l.presence(f(),function(b,d){d?a&&l.presence(f(a),function(a,b){b?c(b):a&&e(a)}):e(b)});return this}}})(window.Realtime.Storage=window.Realtime.Storage||{})})(window.Realtime=window.Realtime||{});
(function(c){(function(j){j.TableSnapshot=function(g){this.ref=function(){return new c.Storage.TableRef(g)};this.val=function(){return g.name}}})(window.Realtime.Storage=window.Realtime.Storage||{})})(window.Realtime=window.Realtime||{});
(function(c){(function(j,g){j.ItemRef=function(i){function f(a,b,d){l.channels[s]||(l.isConnected()?l.subscribe({name:s}):l.createChannel({name:s}),l.channels[s].bind({message:function(a){var b=c.JSON.parse(a.message);n.listeners(v[b.type]).length!=0&&k.meta(function(a){var d={};d[v[b.type]]=new c.Storage.ItemSnapshot({key:{primary:b[a.key.primary.name],secondary:a.key.secondary?b[a.key.secondary.name]:g},table:k,connection:l,value:b.data,operationManager:q});n.fire(d)})}}));var f={};f[v[a]]=d;n[b?
"once":"bind"](f)}function a(a){if(typeof p.primary=="undefined")return"Missing primary key. Must be specified when creating an ItemRef.";if(typeof p.primary!=a.primary.dataType)return"The primary key specified does not match the table schema.";if(a.secondary){if(typeof p.secondary=="undefined")return"Missing secondary key. Must be specified when creating an ItemRef.";if(typeof p.secondary!=a.secondary.dataType)return"The secondary key specified does not match the table schema."}}function b(a,b){if(!a)return"Must specify an event type";
if(a!="put"&&a!="delete"&&a!="update")return"Invalid event type. Possible values: put, delete and update";if(typeof b!="function")return"Must specify an event handler"}function d(a){return new c.Storage.ItemSnapshot({key:p,table:k,connection:l,value:a,operationManager:q})}function j(){var b=arguments[0],c=arguments[1];if(c){var f=typeof arguments[2]=="number"?arguments[2]:1,g=arguments.length,h,i;typeof arguments[g-1]=="function"&&typeof arguments[g-2]=="function"?(h=arguments[g-2],i=arguments[g-
1]):typeof arguments[g-1]=="function"&&(i=arguments[g-1]);k.meta(function(g){(g=a(g.key))?i&&i(g):(g={table:k.name(),key:p,property:c,value:f},q[b](g,function(a){h&&h(d(a))},i))})}else i&&i("The parameter 'property' is mandatory.")}var h=this,k=i.table,l=i.connection,q=i.operationManager,p=i.key,s="rtcs_"+k.name()+":"+p.primary+(typeof p.secondary!="undefined"?"_"+p.secondary:""),v={put:s+":put",update:s+":update","delete":s+":delete"},n={};c.Event.extend(n);this.get=function(b,f){k.meta(function(g){if(g=
a(g.key))return f&&f(g),h;q.getItem({table:k.name(),key:p},function(a){b&&b(c.Util.keys(a).length!=0?d(a):null)},f)});return this};this.set=function(b,f,g){k.meta(function(i){if(i=a(i.key))return g&&g(i),h;if(c.Util.keys(b).length==0)return g&&g("No properties to update"),h;q.updateItem({table:k.name(),key:p,item:b},function(a){f&&f(d(a))},g)});return this};this.del=function(){var b,f,g;switch(arguments.length){case 3:b=arguments[0];f=arguments[1];g=arguments[2];break;case 2:typeof arguments[0]==
"function"&&typeof arguments[1]=="function"?(f=arguments[0],g=arguments[1]):typeof arguments[1]=="function"&&(b=arguments[0],f=arguments[1]);break;case 1:typeof arguments[0]!="function"?b=arguments[0]:f=arguments[0]}k.meta(function(i){if(i=a(i.key))return g&&g(i),this;if(c.Util.isArray(b)&&b.length>0)for(i=0;i<b.length;i++)if(typeof b[i]!="string")return g&&g("Invalid property names. Must be strings"),h;q.deleteItem({table:k.name(),key:p,properties:b},function(a){f&&f(d(a))},g)});return this};this.on=
function(a,c,d){var g=b(a,c);if(g)return d&&d(g),this;f(a,!1,c);a=="put"&&this.get(c,d);return this};this.off=function(a,b,c){if(a&&a!="put"&&a!="delete"&&a!="update")return c&&c("Invalid event type. Possible values: put, delete and update"),this;a?(typeof b!="function"?n.unbindAll(v[a]):(c={},c[v[a]]=b,n.unbind(c)),l.channels[s]&&n.listeners(v.put).length==0&&n.listeners(v.update).length==0&&n.listeners(v["delete"]).length==0&&l.unsubscribe(s)):(n.unbindAll(),l.unsubscribe(s));return this};this.once=
function(a,c,d){var g=b(a,c);if(g)return d&&d(g),this;f(a,!0,c);a=="put"&&this.get(c,d);return this};this.incr=function(a,b,c,d){var f=[].slice.apply(arguments);f.unshift("incr");j.apply(this,f);return this};this.decr=function(a,b,c,d){var f=[].slice.apply(arguments);f.unshift("decr");j.apply(this,f);return this};this.presence=function(a,b){l.presence(s,function(c,d){d?a(d):b(c)});return this}}})(window.Realtime.Storage=window.Realtime.Storage||{})})(window.Realtime=window.Realtime||{});
(function(c){(function(j){j.ItemSnapshot=function(g){this.ref=function(){return new c.Storage.ItemRef(g)};this.val=function(){return g.value}}})(window.Realtime.Storage=window.Realtime.Storage||{})})(window.Realtime=window.Realtime||{});
(function(c){var j=function(){c.Messaging.isReady=!0;c.Messaging.fire({ready:{}})};typeof loadOrtcFactory=="undefined"?c.Util.loadScript(document.location.protocol=="file:"?"http://dfdbz2tdq3k01.cloudfront.net/js/2.1.0/ortc.js":document.location.protocol+"//dfdbz2tdq3k01.cloudfront.net/js/2.1.0/ortc.js",j):j()})(window.Realtime=window.Realtime||{});
